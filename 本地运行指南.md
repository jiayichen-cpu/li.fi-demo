# Perps Trading List 本地运行指南

## 📋 前置要求

- Node.js 20+ 
- npm 或 yarn
- PostgreSQL 数据库（可选，如果只需要查看页面可以跳过）

## 🚀 快速开始

### 1. 安装依赖

```bash
cd /Users/yael/Downloads/lifi-carnival-landing
npm install
```

### 2. 设置环境变量

创建 `.env` 文件（在项目根目录）：

```bash
# 数据库连接（PostgreSQL）
DATABASE_URL="postgresql://user:password@localhost:5432/perps_trading?schema=public"

# Hydromancer API（用于获取交易数据）
HYDROMANCER_API_KEY="your-hydromancer-api-key"

# OneKey Builder 地址
ONEKEY_BUILDER_ADDRESS="0x..."

# Cron 任务密钥（用于保护 /api/cron 端点）
CRON_SECRET="your-secret-key-here"

# PostHog 分析（可选）
NEXT_PUBLIC_POSTHOG_KEY="your-posthog-key"
NEXT_PUBLIC_POSTHOG_HOST="https://us.i.posthog.com"
```

### 3. 初始化数据库（可选）

如果你需要运行完整的 cron 任务来更新排行榜数据：

```bash
# 生成 Prisma Client
npx prisma generate

# 推送数据库架构到数据库
npx prisma db push
```

**注意**：如果只是查看页面，可以跳过这一步。当前 `/perps` 页面使用静态数据，不需要数据库连接。

### 4. 启动开发服务器

```bash
npm run dev
```

服务器将在 `http://localhost:3000` 启动。

## 🌐 访问页面

- **Perps 排行榜页面**：`http://localhost:3000/perps`
- **LI.FI 活动页面**：`http://localhost:3000/lifi`
- **根路径**：`http://localhost:3000`（会自动重定向到 `/perps`）

## 🔄 更新排行榜数据（可选）

如果你配置了数据库和 API 密钥，可以手动触发 cron 任务来更新排行榜：

```bash
curl -X GET http://localhost:3000/api/cron \
  -H "Authorization: Bearer your-secret-key-here"
```

将 `your-secret-key-here` 替换为 `.env` 文件中的 `CRON_SECRET` 值。

## 📝 注意事项

1. **静态数据模式**：当前 `/perps` 页面使用 `LEADERBOARD_DATA` 静态数据，不依赖数据库。如果你需要实时数据，需要：
   - 配置 PostgreSQL 数据库
   - 设置 `HYDROMANCER_API_KEY` 和 `ONEKEY_BUILDER_ADDRESS`
   - 运行 cron 任务更新数据

2. **数据库设置**：
   - 可以使用本地 PostgreSQL 实例
   - 或使用云数据库（如 Supabase、Railway、Neon 等）
   - 确保 `DATABASE_URL` 格式正确

3. **环境变量**：
   - `.env` 文件已在 `.gitignore` 中，不会被提交到仓库
   - 确保不要将 `.env` 文件提交到 Git

## 🐛 常见问题

### 问题：`@prisma/client` 未找到

**解决方案**：
```bash
npx prisma generate
```

### 问题：数据库连接失败

**解决方案**：
- 检查 PostgreSQL 是否运行
- 验证 `DATABASE_URL` 格式是否正确
- 确认数据库用户有足够权限

### 问题：端口 3000 已被占用

**解决方案**：
```bash
# 使用其他端口
PORT=3001 npm run dev
```

### 问题：构建失败

**解决方案**：
```bash
# 清理并重新安装
rm -rf node_modules .next
npm install
npx prisma generate
npm run build
```

## 📦 生产构建

```bash
# 构建生产版本
npm run build

# 启动生产服务器
npm start
```

## 🔍 检查项目状态

```bash
# 检查 Node.js 版本
node --version

# 检查依赖是否安装
ls node_modules

# 检查 Prisma Client 是否生成
ls node_modules/.prisma/client
```

